# #######################################################################################
# HYPRLAND CONFIG 
# #######################################################################################

# -----------------------------------------------------
# 1. MONITOR CONFIGURATION
# -----------------------------------------------------
monitor=DP-3,1920x1080@144,0x0,1
monitor=,preferred,auto,auto

# -----------------------------------------------------
# 2. ENVIRONMENT VARIABLES (NVIDIA & THEME)
# -----------------------------------------------------
# Essential for Nvidia on Wayland
env = LIBVA_DRIVER_NAME,nvidia
env = XDG_SESSION_TYPE,wayland
env = GBM_BACKEND,nvidia-drm
env = __GLX_VENDOR_LIBRARY_NAME,nvidia
env = WLR_NO_HARDWARE_CURSORS,1

# Theming and Cursor
env = XCURSOR_SIZE,24
env = HYPRCURSOR_SIZE,24
env = QT_QPA_PLATFORMTHEME,qt6ct

# Input Method (Fcitx)
env = QT_IM_MODULES="wayland;fcitx;ibus"
env = XMODIFIERS,@im=fcitx

# -----------------------------------------------------
# 3. AUTOSTART
# -----------------------------------------------------
# Authentication Agent (Replaces lxsession)
exec-once = /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1
exec-once = gnome-keyring-daemon --start
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP

# Wallpaper (Replaces feh/nitrogen)
exec-once = swaybg -i ~/Downloads/background.jpg -m fill

# Status Bar (Replaces polybar)
exec-once = waybar

# Tablet Driver
exec-once = otd-daemon

# OCR & Utils
exec-once = transformers_ocr listen
exec-once = nextcloud
exec-once = mpd

# Input Method
exec-once = fcitx5 -dr

# Screenshot
exec-once = flameshot

# Idle
exec-once = hypridle

# Apply GTK Theme
exec-once = gsettings set org.gnome.desktop.interface gtk-theme 'Materia-dark'
exec-once = gsettings set org.gnome.desktop.interface icon-theme 'Papirus'

# -----------------------------------------------------
# 4. VARIABLES
# -----------------------------------------------------
$mainMod = SUPER
$terminal = kitty
$fileManager = thunar
$menu = wofi --show run drun -show-icons 

# -----------------------------------------------------
# 5. INPUT & KEYBOARD
# -----------------------------------------------------
input {
    # Using layout settings from Hyprland config
    #kb_layout = us,ru,jp
    
    follow_mouse = 1
    sensitivity = 0 
    accel_profile = flat
    numlock_by_default = true

    touchpad {
        natural_scroll = false
    }
}

# -----------------------------------------------------
# 6. LOOK AND FEEL
# -----------------------------------------------------
general {
    gaps_in = 5
    gaps_out = 15 
    border_size = 2
    
    col.active_border = rgba(33ccffee) rgba(00ff99ee) 45deg
    col.inactive_border = rgba(595959aa)

    layout = dwindle
    allow_tearing = false
}

decoration {
    rounding = 10
    
    shadow {
        enabled = true
        range = 4
        render_power = 3
        color = rgba(1a1a1aee)
    }

    blur {
        enabled = true
        size = 3
        passes = 1
    }
}

animations {
    enabled = yes
    bezier = myBezier, 0.05, 0.9, 0.1, 1.05
    animation = windows, 1, 5, myBezier
    animation = windowsOut, 1, 5, default, popin 80%
    animation = border, 1, 10, default
    animation = fade, 1, 5, default
    animation = workspaces, 1, 5, default
}

dwindle {
    pseudotile = true
    preserve_split = true
    force_split = 2
}

group {
    col.border_active = rgba(ca9ee6ff) rgba(f2d5cfff) 45deg
    col.border_inactive = rgba(b4befecc) rgba(6c7086cc) 45deg
    
    groupbar {
        enabled = true
        font_size = 10
        text_color = 0xffffffff
        col.active = 0xff33ccff
        col.inactive = 0xff595959
    }
}

# -----------------------------------------------------
# 7. KEYBINDINGS 
# -----------------------------------------------------

# -- groups --
bind = $mainMod CONTROL, left, moveintogroup, l
bind = $mainMod CONTROL, right, moveintogroup, r
bind = $mainMod CONTROL, up, moveintogroup, u
bind = $mainMod CONTROL, down, moveintogroup, d

bind = $mainMod CONTROL, space, moveoutofgroup

bind = $mainMod, Tab, changegroupactive, f
bind = $mainMod SHIFT, Tab, changegroupactive, b

# -- System & Windows --
bind = $mainMod, Return, exec, $terminal
bind = $mainMod SHIFT, Q, killactive, 
bind = $mainMod SHIFT, E, exit, 
bind = $mainMod SHIFT, SPACE, togglefloating, 
bind = $mainMod, D, exec, $menu 
bind = $mainMod, F, fullscreen,

bind = $mainMod, W, togglegroup

# -- i3 Specific F-Key Program Shortcuts --
bind = $mainMod, F1, exec, flatpak run org.mozilla.firefox
bind = $mainMod, F2, exec, flatpak run org.telegram.desktop
bind = $mainMod, F3, exec, thunar
bind = $mainMod, F4, exec, $terminal

# -- Custom Tools (OCR, Cabl, Audio) --
# OCR
bind = $mainMod, O, exec, transformers_ocr recognize
bind = $mainMod SHIFT, O, exec, transformers_ocr hold

# Audio Device Switcher
bind = $mainMod SHIFT, A, exec, ~/.local/bin/audio-device-switcher

# Cabl (Clipboard tool)
bind = $mainMod, C, exec, cabl
bind = $mainMod SHIFT, V, exec, cabl clip

# Screenshots (Flameshot)
bind = $mainMod SHIFT, F, exec, flameshot gui

# -- Focus (Vim Keys - HJKL) --
bind = $mainMod, H, movefocus, l
bind = $mainMod, J, movefocus, d
bind = $mainMod, K, movefocus, u
bind = $mainMod, L, movefocus, r

# -- Focus (Arrow Keys) --
bind = $mainMod, Left, movefocus, l
bind = $mainMod, Down, movefocus, d
bind = $mainMod, Up, movefocus, u
bind = $mainMod, Right, movefocus, r

# -- Move Window (Vim Keys) --
bind = $mainMod SHIFT, H, movewindow, l
bind = $mainMod SHIFT, J, movewindow, d
bind = $mainMod SHIFT, K, movewindow, u
bind = $mainMod SHIFT, L, movewindow, r

# -- Move Window (Arrow Keys) --
bind = $mainMod SHIFT, Left, movewindow, l
bind = $mainMod SHIFT, Down, movewindow, d
bind = $mainMod SHIFT, Up, movewindow, u
bind = $mainMod SHIFT, Right, movewindow, r

# -- Workspaces --
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

# -- Move to Workspace --
bind = $mainMod SHIFT, 1, movetoworkspacesilent, 1
bind = $mainMod SHIFT, 2, movetoworkspacesilent, 2
bind = $mainMod SHIFT, 3, movetoworkspacesilent, 3
bind = $mainMod SHIFT, 4, movetoworkspacesilent, 4
bind = $mainMod SHIFT, 5, movetoworkspacesilent, 5
bind = $mainMod SHIFT, 6, movetoworkspacesilent, 6
bind = $mainMod SHIFT, 7, movetoworkspacesilent, 7
bind = $mainMod SHIFT, 8, movetoworkspacesilent, 8
bind = $mainMod SHIFT, 9, movetoworkspacesilent, 9
bind = $mainMod SHIFT, 0, movetoworkspacesilent, 10

# -- Mouse Control --
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# -- Resizing (Submap / Mode) --
# Hyprland использует "submap" для реализации "mode" из i3
bind = $mainMod, R, submap, resize

submap = resize
binde = , l, resizeactive, 10 0
binde = , h, resizeactive, -10 0
binde = , k, resizeactive, 0 -10
binde = , j, resizeactive, 0 10
binde = , right, resizeactive, 10 0
binde = , left, resizeactive, -10 0
binde = , up, resizeactive, 0 -10
binde = , down, resizeactive, 0 10
bind = , escape, submap, reset 
bind = , return, submap, reset
bind = $mainMod, R, submap, reset
submap = reset

# -- Volume Control (Using wpctl for Wayland/Pipewire) --
bindel = ,XF86AudioRaiseVolume, exec, wpctl set-volume -l 1 @DEFAULT_AUDIO_SINK@ 5%+
bindel = ,XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bindel = ,XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindel = ,XF86AudioMicMute, exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle

# -----------------------------------------------------
# 8. WINDOW RULES
# -----------------------------------------------------
# Fix for Flameshot on Wayland
windowrulev2 = noanim, class:^(flameshot)$
windowrulev2 = float, class:^(flameshot)$
windowrulev2 = move 0 0, class:^(flameshot)$
windowrulev2 = pin, class:^(flameshot)$
windowrulev2 = monitor 0, class:^(flameshot)$

# Prevent some apps from maximizing automatically
windowrulev2 = suppress_event maximize, class:.*
# Opacity (Optional: if you want terminal transparency like in some i3 setups)
#windowrulev2 = opacity 0.9 0.9, class:^(kitty)$
