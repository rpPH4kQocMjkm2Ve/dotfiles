#!/bin/bash

set -euo pipefail

# Функции для монтирования/размонтирования
mount_boot() { sudo mount /dev/disk/by-label/BOOT /boot; }
umount_boot() { 
    if mountpoint -q /boot; then 
        sudo umount /boot
    fi
}

# Обработчик прерываний и очистки
cleanup() {
    umount_boot
}

# Регистрируем обработчики:
# - EXIT: при любом выходе из скрипта
# - SIGINT: Ctrl+C
# - SIGTERM: Системный сигнал завершения
trap cleanup EXIT INT TERM

# Основная функция обновления
update_kernel() {
    mount_boot
    sudo pacman -Syyu
    sync
    umount_boot
}

# Проверка наличия раздела BOOT
boot_status=/dev/disk/by-label/BOOT

if [ -n "" ]; then
    update_kernel
else
    echo "Ошибка: раздел BOOT не найден"
    exit 1
fi
