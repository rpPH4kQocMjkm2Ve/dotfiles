#!/usr/bin/env bash
# Sandboxed OBS Studio via bubblewrap
set -euo pipefail
. "${HOME}/.local/lib/bwrap-common.sh"

A=()
bwrap_gui_setup A yes
bwrap_dbus_system A

# Camera
for dev in /dev/video*; do
    [[ -e "$dev" ]] && A+=(--dev-bind "$dev" "$dev")
done
:

bwrap_bind_dir A bind "${HOME}/.config/obs-studio" "${HOME}/Videos"
bwrap_audio A
A+=(--setenv QT_QPA_PLATFORMTHEME qt6ct)
bwrap_gui_finish A wayland yes

exec bwrap "${A[@]}" -- /usr/bin/obs "$@"
