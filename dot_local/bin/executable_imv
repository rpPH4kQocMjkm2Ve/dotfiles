#!/usr/bin/env bash
set -euo pipefail
. "${HOME}/.local/lib/bwrap-common.sh"

BIN="/usr/bin/$(basename "$0")"
FILE_BINDS=(); ARGS=()
bwrap_resolve_files FILE_BINDS ARGS --ro-bind "$@"

A=()
bwrap_gui_setup A
A+=(--ro-bind-try "${HOME}/.config/imv"       "${HOME}/.config/imv"
    --ro-bind-try "${HOME}/.config/fontconfig" "${HOME}/.config/fontconfig"
    "${FILE_BINDS[@]}")
A+=(--setenv XDG_SESSION_TYPE "${XDG_SESSION_TYPE:-wayland}")
bwrap_wayland A
bwrap_env_base A
bwrap_hardened_malloc A default
bwrap_sandbox A

exec bwrap "${A[@]}" -- "$BIN" "${ARGS[@]}"
